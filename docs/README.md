# Nocturnal by Cycoe
[GitHub 地址][1]
如果在使用过程中发现 bug，可到[此处][1]进行反馈，或者直接提交修复 PR，感谢支持！

## **声明**
Nocturnal 是我课余时间练习 python 代码编写的程序，针对使用引起的一切后果本人概不负责。

## 关于捐赠
Nocturnal 不并强制要求捐赠，但为了防止软件被滥用而出现的一系列问题，因此需要提供解密密钥才能使用，具体操作如下：
1. 打开软件，此时会自动弹出一个命令提示符窗口和一个二维码
2. 微信扫描二维码添加我为好友
3. 你能在命令提示符窗口上看到类似这样一段话
```
你的 id 为 2160。请将 id 发给开发者获取解锁密钥
请输入解密密钥: 
```
4. 将其中的 id 发给我，我会生成解密密钥
5. 输入密钥后即可使用
6. （可选）如果你觉得这个软件给你带来了便利，你可以给开发者包个红包，建议 5 元

## 使用说明

### 命令帮助
| 命令全称   | 缩写 | 描述             |
|------------|------|------------------|
| help       | h    | 打印帮助信息     |
| emailLogin | el   | 绑定通知邮箱     |
| grade      | g    | 成绩抓取模式     |
| report     | r    | 选报告模式       |
| class      | c    | 选课模式         |
| add        | a    | 添加待选课程名称 |
| delete     | de   | 删除待选课程名称 |
| list       | l    | 列出待选课程名称 |
| donate     | d    | 捐赠             |
| quit       | q    | 退出             |

以上表格第一列为命令的全称，第二列为命令的缩写，输入全称与缩写拥有同样的效果。

### 软件符号说明
Nocturnal 使用字符界面（TUI）进行交互，双击 `Nocturnal.exe` 打开软件后可看到一个黑底白字的字符界面，这不是因为软件运行出错，而是 Nocturnal 本来就是这样的。现在你应该能在界面上看到一些表格，最上面的表格为 Nocturnal 的基本信息，中间的表格为使用帮助。在最下方你可以看到类似这样的提示符 `[0] >>> `，该提示符表明此时你可以输入命令运行相关功能，`[0]` 中的数字表示后台正在运行的任务数量。

### 成绩抓取模式
在 `[0] >>> ` 后输入 `grade` 或 `g` 回车即可运行成绩抓取功能。第一次使用时会自动提示你输入用户名和密码，也就是你的教务网学号和密码。运行成功后不会有提示，但 Nocturnal 就会在后台自动抓取成绩，并在出新成绩时自动通知。

### 选报告模式
在 `[0] >>> ` 后输入 `report` 或 `r` 回车即可运行选报告模式，运行成功后 Nocturnal 会在后台自动抓取报告列表，并在有新报告放出时自动选报告，并通过邮件通知你。

### 选课模式
选课模式与成绩抓取模式和选报告模式不同，选课模式需要在前台运行。选课模式通过匹配关键字实现，针对每门课程可以添加多个关键字。比如你想要选 '高分子研究方法' 这门课，则可以在一级关键字后输入 '高分子研究方法' 并回车。但一般课程会有多个时间开课，如果想要指定特定时间或特定老师的课程，则可在二级关键字后输入 '周一' 或 '某某某老师' 即可。Nocturnal 会首先检查一级关键字，如果一级关键字对应多个候选，那么会继续以二级关键字进行过滤，优先选择符合二级关键字的候选。但如果二级关键字过滤后没有可选课程，那么会返回一级关键字的候选列表，并随机选取一个候选作为最终选择。**总而言之，Nocturnal 中的关键字列表并不是选课的唯一列表，而是一个优先列表，Nocturnal 会按关键字列表所给的优先顺序依照选取所有可选课程。**

**注意：选课模式还未经过测试，选课完成后务必登录教务网检查已选课程。**

具体流程如下：
1. 输入 `a` 回车添加需要选的课程名称，输入 `a` 后提示如下：
```
[0] >>> a
please input 1th key
> 
```
`>` 表示此时你可输入一级关键字，一般我们会将课程名称作为一级关键字，如此时你可输入 '高分子研究方法' 回车添加一个关键字，完成后程序会提示你输入二级关键字如下：
```
[0] >>> a
please input 1th key
> 高分子研究方法
please input 2th key
> 
```
此时你可直接输入回车来结束关键字的输入（在输入任一关键字时，你都可通过直接回车来结束输入），或者输入 '周六' 回车作为想要上课的时间。

重复以上步骤直至你输入了所有想要选的课程。

2. 输入 `l` 查看已经输入的课程列表
3. 输入 `d` 删除不想选的课程

### 邮件通知
Nocturnal 目前只有通过邮箱一种方式对你进行通知，你可通过输入 `el` 来绑定邮箱，Nocturnal 会提示你一步一步进行操作。<接收邮箱>为你要接收通知的邮箱，建议使用 qq 邮箱，这样使用微信绑定 qq 邮箱后就可以的即时地收到邮件通知消息。<发送邮箱>可以使用任意邮箱，但发送邮箱需要输入密码。<smtp 主机地址> 为发送邮箱的主机地址，qq 邮箱对应的是 'smtp.qq.com'，163 邮箱对应 'smtp.163.com'，其他邮箱请自行百度。<端口> 默认值为 '25'（**注意：使用端口 25 意味着不使用 SSL 加密，希望邮件加密的同学请自行百度**）。每步输入过程中，提示符后括号中为原始值，如果你不希望更改原始值，直接回车即可。


## 更新日志

### Date: 2017-1-3
**Version: V4.0**

### Date: 2017-12-15
**Version: V3.1**

[bug fix]
- 修复掉线后不能重新登录的问题
- 修复达到最大重试次数后不会自动停止的问题

[optimization]
- 重新登录时清理内存
- 简化代码结构
- 新增等待时的动画效果
- 完善自定义邮箱登录


### Date: 2017-12-14
**Version: V3.0**

[bug fix]
- 修复选报告时的崩溃问题

[optimization]
- 重磅更新！新增验证码自动识别，花了大力气才写出来，现在无需手动输入验证码登录
- 更新了选报告的入口，优化了休眠逻辑
- 命令行提示已汉化
- 优化邮件提醒，现在只会发送最新选到的报告列表
- 新增报告黑名单，选到的报告自动加入黑名单列表中，防止手动退了后又重复选上
- 新增捐赠入口，希望大家多多支持！
- 打包成安装文件，不用再手动解压


[1]: https://git.coding.net/cycoe/Nocturnal.git "Nocturnal GitHub"
